# name: test/sql/bitmap_idx_create.test
# description: test bitmap index creation (dummy implementation)
# group: [sql]

require bitmap_idx

# 测试1: 创建测试表
statement ok
CREATE TABLE test_table (
    id INTEGER,
    status VARCHAR,
    category INTEGER
);

# 测试2: 插入测试数据
statement ok
INSERT INTO test_table VALUES
    (1, 'active', 7),
    (2, 'inactive', 7),
    (3, 'active', 8),
    (4, 'pending', 8),
    (5, 'active', 9);

# 测试3: 不支持字符串索引
statement error
CREATE INDEX idx_status ON test_table USING BITMAP(status);
----
Not implemented Error: Bitmap index currently supports only integer-like types


# 测试5: 创建INTEGER索引
statement ok
CREATE INDEX idx_category ON test_table USING BITMAP(category);

# 测试6: 验证索引存在
query I
SELECT COUNT(*) FROM pragma_bitmap_index_info();
----
1

# 测试7: 测试IF NOT EXISTS（不应报错）
statement ok
CREATE INDEX IF NOT EXISTS idx_category ON test_table USING BITMAP(category);

# 测试8 不支持重复索引
statement error
CREATE INDEX idx_category ON test_table USING BITMAP(category);
----
Catalog Error: Index with name "idx_category" already exists!

# 测试9: 不支持多列索引
statement error
CREATE INDEX idx_combined ON test_table USING BITMAP(status, category);
----
Not implemented Error: Bitmap indexes currently support a single key column

# 测试11: DROP INDEX（测试CommitDrop）
statement ok
DROP INDEX idx_category;

# 测试12: 验证索引已删除
query I
SELECT COUNT(*) FROM pragma_bitmap_index_info();
----
0

# 测试13: 清理
statement ok
DROP TABLE test_table;
